(function(e){function t(t){for(var n,i,r=t[0],c=t[1],d=t[2],m=0,l=[];m<r.length;m++)i=r[m],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&l.push(o[i][0]),o[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(l.length)l.shift()();return a.push.apply(a,d||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],n=!0,r=1;r<s.length;r++){var c=s[r];0!==o[c]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=s[0]))}return e}var n={},o={app:0},a=[];function i(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=n,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var u=c;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var n=s("85ec"),o=s.n(n);o.a},"15d5":function(e,t,s){"use strict";var n=s("9273"),o=s.n(n);o.a},"1fd4":function(e,t,s){"use strict";var n=s("2f03"),o=s.n(n);o.a},"2f03":function(e,t,s){},"3dcb":function(e,t,s){"use strict";var n=s("d90c"),o=s.n(n);o.a},"56d7":function(e,t,s){"use strict";s.r(t);var n=s("2b0e"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.nodDetected?"withNode":"",attrs:{id:"app_meet_party_button"}},[e.loaded?s("ReactionTray"):e._e(),e.loaded?s("MessageWrapper"):e._e()],1)},a=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"main-tray"},[s("div",{staticClass:"tray-inner"},[s("HandUpButton")],1)])},r=[],c=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tray-button-outer",attrs:{tabindex:"0"},on:{focus:e.closeDropdown,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendHand()},click:function(t){return e.sendHand()}}},[s("a",{staticClass:"tray-button",attrs:{tabindex:"-1","aria-label":"Send Party Poppers",role:"button"}},[s("div",{staticClass:"tray-button-bg"}),s("img",{staticStyle:{height:"32px"},attrs:{src:e.getHand}})])])},d=[];const u=(e,t)=>{var s=document.querySelectorAll(e);return[].filter.call(s,(function(e){return RegExp(t).test(e.textContent)}))},m=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,s="x"==e?t:3&t|8;return s.toString(16)}));var l={computed:{getHand(){return`chrome-extension://${this.$store.state.extensionID}/img/hand.png`},getUsername(){return this.$store.state.isFullName?this.$store.getters.getUser("fullName"):this.$store.getters.getUser("name")}},methods:{sendHand(){this.$store.dispatch("closeDropdown","reactions");m();this.$store.state.hands.filter(e=>!0===e.owner).length<1&&(this.$store.dispatch("addMessage",{messageId:m(),emoji:"hand",username:this.getUsername,img:this.$store.getters.getUser("avatar"),owner:!0,tone:this.$store.state.tone}),this.$socket.sendObj({action:"MESSAGE",message:{id:this.$store.getters.getUser("meetingID"),emoji:"hand",username:this.getUsername,img:this.$store.getters.getUser("avatar"),tone:this.$store.state.tone}}),this.$gtag.event("click",{event_category:"Reactions",event_label:"Hand Up",event_value:this.$store.state.tone}))},closeDropdown(){this.$store.dispatch("closeDropdown","reactions")}}},g=l,h=(s("15d5"),s("2877")),p=Object(h["a"])(g,c,d,!1,null,"6e7a13ec",null),f=p.exports,v={components:{HandUpButton:f},created:function(){const e=localStorage.getItem("nod-skinTone");e?this.$store.dispatch("setTone",parseInt(e)):localStorage.setItem("nod-skinTone",0)}},b=v,x=(s("1fd4"),Object(h["a"])(b,i,r,!1,null,null,null)),$=x.exports,y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div")},w=[],j=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"nod-message"},[s("div",{staticClass:"nod-emoji-wrapper"},[s("img",{staticClass:"nod-emoji",attrs:{src:e.getEmoji,alt:e.emoji}})]),s("img",{staticClass:"nod-avatar",attrs:{src:e.img,alt:e.username}}),e._v(" "+e._s(e.username)+" ")])},D=[],k={computed:{getEmoji(){return this.tone>=0?`chrome-extension://${this.$store.state.extensionID}/img/tones/${this.tone}/${this.emoji}.gif`:`chrome-extension://${this.$store.state.extensionID}/img/tones/0/${this.emoji}.gif`}},props:{username:String,emoji:String,img:String,tone:Number}},I=k,S=(s("fe15"),Object(h["a"])(I,j,D,!1,null,"cf499e60",null)),_=S.exports,O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"nod-message",on:{mouseenter:function(t){return t.target!==t.currentTarget?null:e.mouseIn(t)},mouseleave:function(t){return t.target!==t.currentTarget?null:e.mouseOut(t)},click:function(t){return e.removeHand(e.messageId)}}},[s("div",{staticClass:"nod-emoji-wrapper"},[e.hover?s("img",{staticClass:"nod-emoji",attrs:{src:e.getCloseButton,alt:"Remove icon"}}):s("img",{staticClass:"nod-emoji",attrs:{src:e.getEmoji,alt:"Hands up emoji"}})]),s("img",{staticClass:"nod-avatar",attrs:{src:e.img,alt:e.username}}),e._v(" "+e._s(e.username)+" ")])},E=[],U={computed:{getEmoji(){return this.tone>=0?`chrome-extension://${this.$store.state.extensionID}/img/tones/${this.tone}/hand.gif`:`chrome-extension://${this.$store.state.extensionID}/img/tones/0/hand.gif`},getCloseButton(){return`chrome-extension://${this.$store.state.extensionID}/img/down.png`}},props:{username:String,img:String,messageId:String,tone:Number},data(){return{hover:!1}},methods:{mouseIn(){this.hover=!0},mouseOut(){this.hover=!1},removeHand(e){this.$store.dispatch("removeHand",e),this.$socket.sendObj({action:"REMOVE",message:{id:this.$store.getters.getUser("meetingID"),messageId:e}})}}},C=U,N=(s("3dcb"),Object(h["a"])(C,O,E,!1,null,"86510af0",null)),H=N.exports,M={components:{Message:_,Hand:H},computed:{messages(){return this.$store.state.messages},hands(){return this.$store.state.hands}},created:function(){this.$options.sockets.onmessage=({data:e})=>{const t=JSON.parse(e);switch(t.action){case"MESSAGE":this.$store.dispatch("addMessage",{messageId:t.message.messageId||m(),emoji:t.message.emoji,username:t.message.username,img:t.message.img,owner:!1,tone:t.message.tone});break;case"QUEUE":this.$store.dispatch("addHand",{messageId:t.message.messageId,username:t.message.username,img:t.message.img,owner:!1,tone:t.message.tone}),0==this.$store.state.visible&&"true"==localStorage.getItem("notificationStatus")&&chrome.runtime.sendMessage(this.$store.state.extensionID,{type:"displayNotification",options:{title:"Notification from Nod",message:t.message.username,iconUrl:t.message.tone?`chrome-extension://${this.$store.state.extensionID}/img/tones/${t.message.tone}/hand.gif`:`chrome-extension://${this.$store.state.extensionID}/img/tones/0/hand.gif`,type:"basic"}});break;case"REMOVE":this.$store.dispatch("removeHand",t.message.messageId);break}}}},T=M,L=(s("988d"),Object(h["a"])(T,y,w,!1,null,"5ccdf584",null)),F=L.exports,A={name:"App",data(){return{loaded:!1,nodDetected:!1}},components:{ReactionTray:$,MessageWrapper:F},created:function(){this.getData(),this.$options.sockets.onopen=e=>{this.websocketInit(),this.setupListeners()},this.setupObserver()},methods:{getData(){const e=u("script","ds:7"),t=JSON.parse(e[1].text.match(/\[[^\}]*/)[0]),s=t[6]||"Guest",n=!!document.querySelector("#app");let o={meetingID:document.querySelector("[data-unresolved-meeting-id]").getAttribute("data-unresolved-meeting-id"),name:s.split(" ")[0],fullName:s,team:t[28],avatar:t[5],withNode:n};this.$store.dispatch("addUserData",o);const a="true"===localStorage.getItem("nod-isFullName");a&&this.$store.dispatch("setFullName",a)},websocketInit(){this.loaded=!0,this.$socket.sendObj({route:"join",data:{id:this.$store.getters.getUser("meetingID"),team:this.$store.getters.getUser("team")}}),console.log("%c Initialised Nod Extension.","background: #4D2F3C; color: #FBE2A0"),console.log("%c Something gone wrong? Let me know - hi@jamiec.io","background: #4D2F3C; color: #FBE2A0");const e=()=>{console.log("Keeping Nod alive..."),this.$socket.sendObj({route:"ping"})};setInterval(e,54e4)},setupListeners(){this.setupTabListener(),this.setupDestroyListener(),this.setupVisibilityListeners()},setupVisibilityListeners(){const e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?e.$store.dispatch("setVisible",!1):e.$store.dispatch("setVisible",!0)}))},setupTabListener(){document.addEventListener("keydown",(function(e){9===e.keyCode&&(document.activeElement!=document.body&&null!=document.activeElement||(e.preventDefault(),document.getElementById("nodBtn").focus()))}))},async setupDestroyListener(){window.addEventListener("beforeunload",e=>{this.$socket.sendObj({route:"disconnect",data:{id:this.$store.getters.getUser("meetingID")}})});while(null==document.querySelector("[data-call-ended='true']"))await new Promise(e=>setTimeout(e,200));this.loaded=!1,this.$socket.sendObj({route:"disconnect",data:{id:this.$store.getters.getUser("meetingID")}}),this.$socket.close()},setupObserver(){var e=document.querySelector("body"),t={attributes:!1,childList:!0};const s=e=>{for(var t of e)if("childList"==t.type){const e=Array.from(t.addedNodes).find(e=>"app"===e.id);e&&(this.nodDetected=!0)}},n=new MutationObserver(s);n.observe(e,t)}}},P=A,V=(s("034f"),Object(h["a"])(P,o,a,!1,null,null,null)),B=V.exports,R=s("b408"),q=s.n(R),J=s("2f62");n["a"].use(J["a"]);var G=new J["a"].Store({state:{extensionID:"mhkffmllohoiiflajcdmpkfdioknejhb",userData:{},messages:[],hands:[],reactions:!1,settings:!1,updateAvailable:!1,updateChecked:!1,visible:!0,isFullName:!1,tone:0},getters:{getUser:e=>t=>e.userData[t]},mutations:{addMessage(e,t){"hand"===t.emoji&&window.confetti&&window.confetti({particleCount:100,spread:70,origin:{y:.6}}),e.messages.unshift(t)},removeMessage(e,t){e.messages=e.messages.filter(e=>e!=t)},addHand(e,t){e.hands.unshift(t)},removeHand(e,t){e.hands=e.hands.filter(e=>e.messageId!=t)},addUserData(e,t){e.userData=t},openDropdown(e,t){e[t]=!0},closeDropdown(e,t){e[t]=!1},setUpdateStatus(e,t){e.updateAvailable=t},setUpdateChecked(e,t){e.updateChecked=t},setVisible(e,t){e.visible=t},setTone(e,t){e.tone=t},setFullName(e,t){e.isFullName=t}},actions:{addMessage(e,t){e.commit("addMessage",t),setTimeout(()=>{e.commit("removeMessage",t)},3e3)},addHand(e,t){e.commit("addHand",t)},removeHand(e,t){e.commit("removeHand",t)},openDropdown(e,t){e.commit("openDropdown",t)},closeDropdown(e,t){e.commit("closeDropdown",t)},addUserData(e,t){e.commit("addUserData",t)},setUpdateStatus(e,t){e.commit("setUpdateStatus",t)},setUpdateChecked(e,t){e.commit("setUpdateChecked",t)},setVisible(e,t){e.commit("setVisible",t)},setTone(e,t){e.commit("setTone",t)},setFullName(e,t){e.commit("setFullName",t)}}}),W=s("a584");n["a"].config.productionTip=!1;const z="wss://vw0c45hcyh.execute-api.us-east-1.amazonaws.com/prod/";n["a"].use(q.a,z,{format:"json"}),n["a"].use(W["a"],{config:{id:"UA-155560918-5"},disableScriptLoad:!0}),new n["a"]({store:G,render:function(e){return e(B)}}).$mount("#app_meet_party_button")},"68c8":function(e,t,s){},"85ec":function(e,t,s){},9273:function(e,t,s){},"988d":function(e,t,s){"use strict";var n=s("c485"),o=s.n(n);o.a},c485:function(e,t,s){},d90c:function(e,t,s){},fe15:function(e,t,s){"use strict";var n=s("68c8"),o=s.n(n);o.a}});
//# sourceMappingURL=app.js.map